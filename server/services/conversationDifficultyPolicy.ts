/**
 * ëŒ€í™” ë‚œì´ë„ ì •ì±… ê´€ë¦¬
 * 
 * 4ë‹¨ê³„ ëŒ€í™” ë‚œì´ë„ì— ë”°ë¥¸ AI í”„ë¡¬í”„íŠ¸ ì§€ì¹¨ ìƒì„±
 * - Level 1: ë§¤ìš° ì‰¬ì›€/íŠœí† ë¦¬ì–¼
 * - Level 2: ê¸°ë³¸ ë‚œì´ë„
 * - Level 3: ë„ì „í˜•
 * - Level 4: ê³ ë‚œë„/ì‹¤ì „í˜• (ê¸°ë³¸ê°’)
 */

export interface DifficultyGuidelines {
  level: number;
  name: string;
  description: string;
  responseLength: string;
  tone: string;
  pressure: string;
  feedback: string;
  constraints: string[];
}

/**
 * ë‚œì´ë„ ë ˆë²¨ì— ë”°ë¥¸ ëŒ€í™” ì§€ì¹¨ ë°˜í™˜
 */
export function getDifficultyGuidelines(level: number = 4): DifficultyGuidelines {
  const guidelines: Record<number, DifficultyGuidelines> = {
    1: {
      level: 1,
      name: 'ë§¤ìš° ì‰¬ì›€ / íŠœí† ë¦¬ì–¼',
      description: 'ì´ˆë³´ìë¥¼ ìœ„í•œ ì¹œì ˆí•˜ê³  êµìœ¡ì ì¸ ëŒ€í™”',
      responseLength: '1-3ë¬¸ì¥, ì§§ê³  ëª…í™•í•˜ê²Œ. í•„ìš” ì‹œ ì˜ˆì‹œ ì¶”ê°€.',
      tone: 'ë§¤ìš° ì¹œì ˆí•˜ê³  ê²©ë ¤ì , ì²œì²œíˆ ì„¤ëª…',
      pressure: 'ì••ë°•ê° ì—†ìŒ. ì‹¤ìˆ˜í•´ë„ ê¸ì •ì  í”¼ë“œë°± ì œê³µ.',
      feedback: 'ì¢‹ì€ ì˜ˆì‹œë¥¼ ë“¤ì–´ì£¼ê³ , ë¶€ë“œëŸ½ê²Œ ê°€ì´ë“œ. "ì¢‹ì€ ìƒê°ì´ì—ìš”!", "ì´ë ‡ê²Œ í•´ë³´ì‹œëŠ” ê±´ ì–´ë–¨ê¹Œìš”?"',
      constraints: [
        'ìƒëŒ€ë°©ì„ ë§ì´ ë°°ë ¤í•˜ë©° ëŒ€í™”',
        'ê°ˆë“± ìƒí™© ê±°ì˜ ì—†ìŒ',
        'ë°˜ë³µ í™•ì¸ê³¼ ëª…í™•í•œ ì„¤ëª…',
        'ê¸ì •ì ì´ê³  ê²©ë ¤í•˜ëŠ” ë§íˆ¬',
        'ìƒì„¸í•œ ì„¤ëª…ê³¼ ì˜ˆì‹œ ì œê³µ'
      ]
    },
    2: {
      level: 2,
      name: 'ê¸°ë³¸ ë‚œì´ë„',
      description: 'ì¹œì ˆí•˜ì§€ë§Œ í˜„ì‹¤ì ì¸ ëŒ€í™”',
      responseLength: '1-2ë¬¸ì¥, ëª…í™•í•˜ê³  í˜„ì‹¤ì ìœ¼ë¡œ',
      tone: 'ì¹œì ˆí•˜ì§€ë§Œ ì–´ëŠ ì •ë„ í˜„ì‹¤ì ì¸ ë°˜ì‘',
      pressure: 'ì•½í•œ ê°ˆë“±ê³¼ ì••ë°• ì¡´ì¬. ì‹¤ìˆ˜í•´ë„ ë‹¤ì‹œ ê¸°íšŒë¥¼ ì¤Œ.',
      feedback: 'ì„¤ëª…ì€ í•´ì£¼ë˜, ì‚¬ìš©ìê°€ ìŠ¤ìŠ¤ë¡œ ìƒê°í•´ë³´ë„ë¡ ìœ ë„. "ê·¸ëŸ°ë° ~ëŠ” ê³ ë ¤í•˜ì…¨ë‚˜ìš”?", "ì¡°ê¸ˆ ë” êµ¬ì²´ì ìœ¼ë¡œ ë§ì”€í•´ì£¼ì‹œê² ì–´ìš”?"',
      constraints: [
        'ë°°ë ¤ì‹¬ì€ ìˆìœ¼ë‚˜ í˜„ì‹¤ì  ë°˜ì‘',
        'ì•½í•œ ê°ˆë“± ìƒí™© ì¡´ì¬',
        'ì„¤ëª… ì œê³µí•˜ë˜ ìŠ¤ìŠ¤ë¡œ ìƒê° ìœ ë„',
        'ê³µê°ê³¼ ë…¼ë¦¬ì˜ ê· í˜•',
        'ì¡°í™”ë¡­ì§€ë§Œ ëª…í™•í•œ ì…ì¥ ìœ ì§€'
      ]
    },
    3: {
      level: 3,
      name: 'ë„ì „í˜•',
      description: 'ë…¼ë¦¬ì  ê·¼ê±°ë¥¼ ìš”êµ¬í•˜ëŠ” ë„ì „ì  ëŒ€í™”',
      responseLength: '1-2ë¬¸ì¥, í•µì‹¬ë§Œ ê°„ê²°í•˜ê²Œ. ë…¼ë¦¬ì™€ ê·¼ê±° ìš”êµ¬.',
      tone: 'í˜„ì‹¤ì ì´ê³  ë¹„íŒì . ì•½ê°„ì˜ ì••ë°•ê° ìˆëŠ” ì§ˆë¬¸.',
      pressure: 'ì¤‘ê°„ ì••ë°•. ê°ì •ê³¼ ì´í•´ê´€ê³„ ë¬¸ì œ ë“±ì¥, ì„¤ë“/í˜‘ìƒ í•„ìš”.',
      feedback: 'ë…¼ë¦¬ì™€ ê·¼ê±°ë¥¼ ìš”êµ¬. ë¹„íŒì  ì§ˆë¬¸. "ê·¸ ê·¼ê±°ê°€ ë­”ê°€ìš”?", "ì‹¤í˜„ ê°€ëŠ¥ì„±ì€ ì–´ë–»ê²Œ ë³´ì‹œë‚˜ìš”?", "ë‹¤ë¥¸ ê´€ì ì€ ìƒê°í•´ë³´ì…¨ë‚˜ìš”?"',
      constraints: [
        'ë…¼ë¦¬ì  í—ˆì  ì§€ì ',
        'ë¹„íŒì ì´ê³  ë¶„ì„ì  ì§ˆë¬¸',
        'êµ¬ì²´ì  ê·¼ê±°ì™€ ê³„íš ìš”êµ¬',
        'ê°ì •ë³´ë‹¤ ë…¼ë¦¬ ì¤‘ì‹œ',
        'ì„¤ë“ê³¼ í˜‘ìƒ ëŠ¥ë ¥ í•„ìš”'
      ]
    },
    4: {
      level: 4,
      name: 'ê³ ë‚œë„ / ì‹¤ì „í˜•',
      description: 'ì‹¤ì „ê³¼ ê°™ì€ ì••ë°•ê° ìˆëŠ” ëŒ€í™”',
      responseLength: '1-2ë¬¸ì¥, ë§¤ìš° ì§§ê³  ì§ì„¤ì . 10-15ë‹¨ì–´ ì´ë‚´ ê¶Œì¥.',
      tone: 'ë°”ì˜ê³  ì—¬ìœ  ì—†ìŒ. ì§ì„¤ì ì´ê³  ë•Œë¡œëŠ” ë¹„íŒì .',
      pressure: 'ê°•í•œ ì••ë°•. ì‹œê°„ ì œì•½, ê°ˆë“±, ì´í•´ê´€ê³„ ì¶©ëŒ. ë¹ ë¥¸ ê²°ì • ìš”êµ¬.',
      feedback: 'ì• ë§¤í•˜ë©´ "ê·¸ë˜ì„œ ê²°ë¡ ì´ ë­”ê°€ìš”?" ê°™ì€ ì••ë°•. ê°ì • ìƒí•  ìˆ˜ ìˆìŒ. ë°˜ë°•ê³¼ ë¹„íŒì  ë°˜ì‘. ì£¼ë„ì  êµ¬ì¡°í™”/ì„¤ë“/ê³µê° ìŠ¤í‚¬ í•„ìš”.',
      constraints: [
        '**ìµœëŒ€ 1-2ë¬¸ì¥ë§Œ**: ì ˆëŒ€ë¡œ 3ë¬¸ì¥ ì´ìƒ ë§í•˜ì§€ ë§ˆì„¸ìš”',
        '**ì¦‰ê° ë°˜ì‘**: ê¸´ ì„¤ëª… ì—†ì´ í•µì‹¬ë§Œ ë¹ ë¥´ê²Œ',
        '**ì••ë°• í‘œí˜„ í•„ìˆ˜**: "ë¹¨ë¦¬", "ì§€ê¸ˆ", "ê¸‰í•´ìš”", "ì‹œê°„ ì—†ì–´ìš”" í¬í•¨',
        '**ê³µê²©ì  ë°˜ì‘**: ëŠë¦° ë°˜ì‘ì— ë‹µë‹µí•´í•˜ê³  ì§œì¦',
        '**ê°ì • í­ë°œ ê°€ëŠ¥**: í•„ìš”í•˜ë©´ í™”ë‚´ê³  ëª©ì†Œë¦¬ ë†’ì„',
        '**ë¹„íŒì  íƒœë„**: ê·¼ê±° ì—†ìœ¼ë©´ ì¦‰ì‹œ ë°˜ë°•'
      ]
    }
  };

  // ìœ íš¨í•˜ì§€ ì•Šì€ ë ˆë²¨ì´ë©´ ê¸°ë³¸ê°’ 4 ë°˜í™˜
  return guidelines[level] || guidelines[4];
}

/**
 * ì‹¤ì‹œê°„ ìŒì„±ìš© ìƒì„¸ ì§€ì¹¨ ìƒì„± (realtimeVoiceServiceì—ì„œ ì‚¬ìš©)
 */
export function getRealtimeVoiceGuidelines(level: number = 4): string {
  const guide = getDifficultyGuidelines(level);

  const sections = [
    `# ğŸ­ ëŒ€í™” ë‚œì´ë„ ì„¤ì •: Level ${guide.level} - ${guide.name}`,
    ``,
    `## ğŸ“Š ë‚œì´ë„ ê°œìš”`,
    guide.description,
    ``,
    `## ğŸ’¬ ëŒ€í™” ë°©ì‹`,
    `- **ì‘ë‹µ ê¸¸ì´**: ${guide.responseLength}`,
    `- **ë§íˆ¬/í†¤**: ${guide.tone}`,
    `- **ì••ë°•ê°**: ${guide.pressure}`,
    ``,
    `## ğŸ¯ í”¼ë“œë°± ë°©ì‹`,
    guide.feedback,
    ``,
    `## âš ï¸ í•„ìˆ˜ ì œì•½ì‚¬í•­`,
    ...guide.constraints.map(c => `- ${c}`),
    ``
  ];

  return sections.join('\n');
}

/**
 * í…ìŠ¤íŠ¸/TTSìš© ê°„ê²°í•œ ì§€ì¹¨ ìƒì„± (optimizedGeminiProviderì—ì„œ ì‚¬ìš©)
 */
export function getTextModeGuidelines(level: number = 4): string {
  const guide = getDifficultyGuidelines(level);

  const sections = [
    `[ëŒ€í™” ë‚œì´ë„: Level ${guide.level} - ${guide.name}]`,
    `ì‘ë‹µ ê¸¸ì´: ${guide.responseLength}`,
    `ë§íˆ¬: ${guide.tone}`,
    `ì••ë°•ê°: ${guide.pressure}`,
    `ì œì•½ì‚¬í•­: ${guide.constraints.slice(0, 3).join(', ')}`
  ];

  return sections.join('\n');
}

/**
 * ë‚œì´ë„ ë ˆë²¨ ê²€ì¦ (1-4 ë²”ìœ„)
 * ê¸°ë³¸ê°’: 2 (ê¸°ë³¸ ë‚œì´ë„) - ì‚¬ìš©ìê°€ ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì§€ ì•Šì€ ê²½ìš° ì ìš©
 */
export function validateDifficultyLevel(level: number | undefined): number {
  if (level === undefined || level === null) {
    return 2; // ê¸°ë³¸ê°’: ê¸°ë³¸ ë‚œì´ë„
  }
  
  const numLevel = Number(level);
  if (isNaN(numLevel) || numLevel < 1 || numLevel > 4) {
    console.warn(`Invalid difficulty level: ${level}, using default 2`);
    return 2;
  }
  
  return Math.floor(numLevel);
}
